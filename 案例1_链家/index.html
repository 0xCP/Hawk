<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>19.案例1_链家 - Hawk doc</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "19.\u6848\u4f8b1_\u94fe\u5bb6";
    var mkdocs_page_input_path = "\u6848\u4f8b1_\u94fe\u5bb6.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Hawk doc</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">1.Hawk</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../快速教程/">2.快速教程</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../Hawk工程/">3.Hawk工程</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../主要组件介绍/">4.主要组件介绍</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../Hawk任务市场/">5.Hawk任务市场</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../数据表和数据库连接/">6.数据表和数据库连接</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../网页采集器/">7.网页采集器</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../数据清洗/">8.数据清洗</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../转换器/">9.转换器</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../常用/">10.常用</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../过滤器/">11.过滤器</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../执行器/">12.执行器</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../生成器/">13.生成器</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../子任务引擎/">14.子任务引擎</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../动态页面抓取专题/">15.动态页面抓取专题</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../命令行增量和自动化专题/">16.命令行增量和自动化专题</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../编译和扩展开发/">17.编译和扩展开发</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../常见问题/">18.常见问题</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">19.案例1_链家</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#1_">案例1_链家</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#1">1.设计网页采集器</a></li>
        
            <li><a class="toctree-l3" href="#2">2.设计数据清洗</a></li>
        
            <li><a class="toctree-l3" href="#3">3.调用网页采集器</a></li>
        
            <li><a class="toctree-l3" href="#4">4.保存和导出数据</a></li>
        
            <li><a class="toctree-l3" href="#5">5.保存任务</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../案例2_大众点评/">20.案例2_大众点评</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../案例3_百度百家新闻/">21.案例3_百度百家新闻</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../案例4_优酷/">22.案例4_优酷</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../更新日志和作者/">23.更新日志和作者</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../设计Hawk背后的故事(2016)/">24.设计Hawk背后的故事(2016)</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../花一年时间,给爬虫Hawk再讲个故事(2018)/">25.花一年时间,给爬虫Hawk再讲个故事(2018)</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Hawk doc</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>19.案例1_链家</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="1_">案例1_链家</h1>
<hr />
<p>链家的同学请原谅我，但你们的网站做的真是不错。</p>
<h2 id="1">1.设计网页采集器</h2>
<p>我们以爬取链家二手房为例，介绍网页采集器的使用。首先双击图标，加载采集器：</p>
<p><img alt="新建采集器" src="https://images2018.cnblogs.com/blog/287060/201805/287060-20180506161543642-715415702.png" /></p>
<p>在最上方的地址栏中，输入要采集的目标网址，本次是http://bj.lianjia.com/ershoufang/。并点击刷新网页。此时，下方展示的是获取的html文本，目前工作模式默认是<code>List</code>。</p>
<p><img alt="输入网址刷新" src="https://images2018.cnblogs.com/blog/287060/201805/287060-20180506161656798-1250424975.png" /></p>
<p>原始网站页面如下：</p>
<p><img alt="QQ截图20160501121150.jpg-88kB" src="http://static.zybuluo.com/buptzym/nrv8npp2vcl9xgca8uaw6env/QQ%E6%88%AA%E5%9B%BE20160501121150.jpg" /></p>
<p>此时，有两种做法来获取想要的房产数据：</p>
<h3 id="11">1.1.全自动嗅探：手气不错</h3>
<p>直接无脑点击<code>手气不错</code>,弹出下面的界面：</p>
<p><img alt="手气不错" src="https://images2018.cnblogs.com/blog/287060/201805/287060-20180506162114847-660106933.png" /></p>
<p>对于链家这个例子，你可以修改每个列对应的名字，如房价，总面积等。或者更懒一点，直接点击<code>确认结果</code>即可。</p>
<blockquote>
<p>Hawk3的手气不错功能得到大大加强，大部分手工操作已经不需要了。</p>
</blockquote>
<h3 id="12">1.2.手动模式</h3>
<p>在一些情况下，由于软件不知道到底要获取哪些内容，因此需要手工给定几个关键字， 让Hawk搜索关键字， 并获取位置。</p>
<p>以上述页面为例，通过检索820万和51789（单价,每次采集时都会有所不同），我们就能通过DOM树的路径，找出整个房源列表的根节点。</p>
<p>下面是实际步骤</p>
<p><img alt="手工添加属性" src="https://images2018.cnblogs.com/blog/287060/201805/287060-20180506162447594-2020334544.png" /></p>
<p>由于要抓取列表，所以<strong>读取模式</strong>选择<strong>List</strong>。 填入搜索字符94.71， 发现能够成功获取XPath,左边的源代码框会自动跳转到对应位置， 编写属性为“面积” ，点击<strong>添加</strong>，即可添加一个属性。类似地，再填入303，设置属性名称为“总价”，即可添加另外一个属性。</p>
<p>如果发现有错误，可点击<strong>编辑集合</strong>， 对属性进行删除，修改和排序。</p>
<p>你可以类似的将所有要抓取的特征字段添加进去，或是直接点击<strong>手气不错</strong>，系统会根据目前的属性，推测其他属性:</p>
<p>属性的名称是自动推断的，如果不满意，可以<strong>修改列表第一列的属性名</strong>，点击刷新后更新。</p>
<p>工作过程中，可点击<strong>提取测试</strong> ，随时查看采集器目前的能够抓取的数据内容。这样，一个链家二手房的网页采集器即可完成。可在网页采集器最上方，修改采集器的模块名称，这样就方便<code>数据清洗</code>任务调用该采集器。</p>
<h2 id="2">2.设计数据清洗</h2>
<h3 id="21url">2.1.构造url列表</h3>
<p>在上一节介绍了如何实现一个页面的采集，但如何采集所有二手房数据呢？ 这涉及到翻页。</p>
<p><img alt="链家翻页控件" src="https://images2018.cnblogs.com/blog/287060/201805/287060-20180506212225505-877226286.png" /></p>
<p>还是以链家为例，翻页时，我们会看到页面是这样变换的：</p>
<pre><code>http://bj.lianjia.com/ershoufang/pg2/
http://bj.lianjia.com/ershoufang/pg3/
…
</code></pre>

<p>因此，需要构造一串上面的url. 聪明的你肯定会想到， 应当先生成一组序列， 从1到100（假设我们只抓取前100页）。</p>
<ol>
<li>除了在软件的欢迎页面上双击<strong>数据清洗</strong>，也可以<code>系统状态视图</code>中<code>已加载任务</code>列表下，点击加号，快速创建新的任务:</li>
</ol>
<p><img alt="更方便地添加任务" src="https://images2018.cnblogs.com/blog/287060/201805/287060-20180506162912806-1622106420.png" /></p>
<p>在左侧的搜索栏中搜索<strong>生成区间数</strong>， 将该模块拖到右侧上方的栏目中：</p>
<p><img alt="QQ截图20160501121554.jpg-29.8kB" src="http://static.zybuluo.com/buptzym/4c642vm06i8ly9chwg4z5ey7/QQ%E6%88%AA%E5%9B%BE20160501121554.jpg" /></p>
<ol>
<li>
<p>在右侧栏目中双击生成区间数，可弹出设置窗口， 为该列起名字(id), 最大值填写为100,生成模式默认为Append:
<em>为什么只显示了前20个？ 这是程序的虚拟化机制， 并没有加载全部的数据，可修改<strong>采样量</strong>（默认为20）。</em></p>
</li>
<li>
<p>将数字转换为url, 熟悉C#的读者，可以想到string.format, 或者python的%符号：搜索<strong>合并多列</strong>，并将其拖拽到刚才生成的id列， 编写format为下图的格式，即可将原先的数值列变换为一组url</p>
</li>
</ol>
<p><img alt="QQ截图20160501121916.jpg-22.9kB" src="http://static.zybuluo.com/buptzym/krygj7w1tnnqg15109nfqy8w/QQ%E6%88%AA%E5%9B%BE20160501121916.jpg" /></p>
<p><em>(如果需要多个列合并为一个列， 则在“其他项” 栏目中填写其他列的列名，用空格分割， 并在format中用{1},{2}..等表示)</em></p>
<p>(由于设计的问题，数据查看器的宽度不超过150像素，因此对长文本显示不全，可以点击单元格弹出对应完整文本。</p>
<h2 id="3">3.调用网页采集器</h2>
<p>生成这串URL之后，我们即可将刚才已经完成的网页采集器处理这串url。</p>
<p>拖拽<strong>从爬虫转换</strong>到当前的url，在<strong>爬虫选择</strong> 栏目中选择刚才配置的采集器名称。
（不少朋友在此处出现问题，需要在<code>从爬虫选择</code>模块中，填写你配置的网页采集器名称，如果没有修改，则默认就是<code>网页采集器</code>）</p>
<p>之后，系统就会转换出爬取的前20条数据：</p>
<p><img alt="QQ截图20160501122007.jpg-127.3kB" src="http://static.zybuluo.com/buptzym/1pza1m030dnnbuiennl97bah/QQ%E6%88%AA%E5%9B%BE20160501122007.jpg" /></p>
<p>可以看到， 数据中“属性3” 列包含html转义符，</p>
<p>拖拽<strong>html字符转义</strong>，到属性3列，即可自动转换所有转义符。</p>
<p><img alt="QQ截图20160501122026.jpg-81.4kB" src="http://static.zybuluo.com/buptzym/8mhj6nlnnj7jey3vpo39jkl5/QQ%E6%88%AA%E5%9B%BE20160501122026.jpg" /></p>
<p>如果要修改列名，在最上方的列名上直接修改， 点击回车即可修改名字。</p>
<p>where（面积）列中包含数字，想把数字提取出来，可以将<strong>提取数字</strong>模块拖拽到该列上，所有数字即可提取出来。</p>
<p>类似地，可以拖拽<strong>字符分割</strong>或<strong>正则分割</strong> 到某一列，从而分割文本和替换文本。此处不再赘述。</p>
<p>有一些列为空，可以拖拽<strong>空对象过滤器</strong> 到该列，那么该列为空的话会自动过滤这一行数据。</p>
<h2 id="4">4.保存和导出数据</h2>
<p>需要保存数据时，可以选择写入文件，或者是临时存储（本软件的数据管理器），或是数据库。这就是执行器的作用。</p>
<blockquote>
<p>执行器代表一些有副作用的模块，在调试模式中它们不会执行，只有在运行时才会生效。</p>
</blockquote>
<p>拖<strong>写入数据表</strong>到任意一列， 并填入<strong>新建表名</strong>(如链家二手房)</p>
<p><img alt="QQ截图20160501122057.jpg-32kB" src="http://static.zybuluo.com/buptzym/fhrvseodtkfgchzat4adk807/QQ%E6%88%AA%E5%9B%BE20160501122057.jpg" /></p>
<p>下图是这次操作的所有子模块列表：</p>
<p><img alt="" src="https://images2018.cnblogs.com/blog/287060/201805/287060-20180506212412941-2067892490.png" /></p>
<p>之后，即可对整个过程进行操作：</p>
<p>选择<strong>串行模式</strong>或<strong>并行模式</strong>， 并行模式使用线程池， 可设定最多同时执行的线程数（最好不要超过100）。推荐使用并行模式，</p>
<p><img alt="" src="https://images2018.cnblogs.com/blog/287060/201805/287060-20180506212447521-940810659.png" /></p>
<p>点击<strong>执行</strong>按钮，即可在任务管理视图中采集数据。</p>
<p><img alt="并行执行效果" src="https://images2018.cnblogs.com/blog/287060/201805/287060-20180506212534331-2087912676.png" /></p>
<p>之后，在<strong>数据管理</strong>的数据表<strong>链家二手房</strong>上点击右键， 选择另存为， 导出到Excel,Json等，即可将原始数据导出到外部文件中。</p>
<p><img alt="保存到文件" src="https://images2018.cnblogs.com/blog/287060/201805/287060-20180506212628260-1233762256.png" /></p>
<p>类似的， 你可以在清洗流程中拖入执行器，则保存的是中间过程，也可以在结尾拖入多个执行器，这样就能同时写入数据库或文件， 从而获得了极大的灵活性。</p>
<h2 id="5">5.保存任务</h2>
<p>在<code>系统状态视图</code>的<code>已加载任务</code>上点击右键，保存任务，即可在欢迎页面中保存新任务（任务名称与当前模块名字一致），下次可直接加载即可。如果存在同名任务， 则会对原有任务进行覆盖。</p>
<p>在<code>已加载任务</code>的空白处，点击<strong>保存所有模块</strong>,会批量保存所有的任务。同样，你可以试着将不同的任务拖拽到下面的图标上，分别可复制，保存和删除任务。</p>
<p><img alt="保存任务" src="https://images2018.cnblogs.com/blog/287060/201805/287060-20180506212852646-1731083660.png" /></p>
<p>你可以将一批任务，保存为一个工程文件(xml)，并在之后将其加载和分发。</p>
<p>这就是Hawk入门的第一篇教程，尽量简单，不涉及复杂操作。</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../案例2_大众点评/" class="btn btn-neutral float-right" title="20.案例2_大众点评">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../常见问题/" class="btn btn-neutral" title="18.常见问题"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../常见问题/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../案例2_大众点评/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
